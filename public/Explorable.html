<html>

<head>
    <title>Introduction to Project: Explorable Mathematical Psychology</title>
    <script src="./js/lib/jquery-3.5.1.min.js"></script>
     <link href="https://fonts.googleapis.com/css2?family=Piazzolla:ital,wght@1,200&family=Playfair+Display&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./css/main.css">
</head>

<body>
    <div class="narrative">
        <h1>Explorable: Mathematical Psychology</h1>
        <h2>As you enter the warm chapel, a <span class="highlight">soft light</span> invites you to the confessional...</h2>
        <p>Mathematical psychology is one of the most fascinating fields out there. It can illuminate our perspective on many daily stuff. Modelling behaviour and then visualizing it? That's a good deal!</p>
        <p>Using a humble combination of Javascript and HTML, we'll explore together what giants in the field of behavioural economics and decision-psychology have found in the past few decades.</p>
        <p>But first, you'll have to remember what you had for lunch... Wake up, Link!</p>
        <p><em><strong>Note: The networked component of this explorable space will occur on Day 7, when you know enough about decision psychology. For full immersion in this beautiful topic, do not skip any days!</strong><em></p>
        <div class="inventory" id="day-1"></div>
    </div>

    <div class="narrative">
        <h1>Day 1: Mary Traded Clouds </h1>
        <p>Flowers dot your vision. Familiar images flood your mind. The scent of laundry. And her laughter makes you happy.</p>
        <p>Your mother calls to you. "Have you taken your lunch dear?"</p>
        <p>You point out to the things you packed this morning.</p>
        <div class="inventory" id="day-1"></div>
    </div>
    <div class="input-instructions">
        <p>"Would you look at that," your mom says. "Someone invented a machine with blue sliders. Try playing with them."</p>
    </div>
    <!-- Economical Standpoint -->
    <!-- Utilitarian Perspective -->
    <div class="slidecontainer">
        <label for="lifeSatisfaction">Life Satisfaction</label>
        <input type="range" min="1" max="100" value="50" class="slider" id="lifeSatisfaction"><br>
        <label for="levelOfConfidence">Level of Confidence</label>
        <input type="range" min="1" max="100" value="50" class="slider" id="levelOfConfidence">
    </div><br>
    <div class="narrative">
        <h1>Day 2: Clouds Traded Mary </h1>
        <h2>You're about to buy your first house today.</h2>
        <p>Once a thrill when browsing the online ads, now you feel an odd sense of panic as you shake the house agent's hand whose wide
          smile disturbs you. What if you make the wrong deal?
        </p>
        <p>Your partner puts a firm hand on your arm. "Mary. We've worked hard for this. You know we deserve it."</p>
        <p>Later that day, as the strange blue lights dim out from the day, you quietly sneak into your work room and you think back on your options.</p>
        <div class="inventory" id="day-2"></div>
    </div>
    <div class="input-instructions">
        <p>Decision psychologists and economists have long studied problems of this type.</p>
        <p>To put it simply, Mary is facing a problem of choice. Her attitude towards risky options is being put into test, and she has to calculate a decision. One of these factors is
          how much she believes a house is valuable to her -- her perceived value. Note that the real, experienced value of owning a house has nothing to do with the expectation of owning it.
        </p>
        <p>And how do we know how much that perceived value is? In prospect theory, the psychophysics of choice in matters of money are not defined by
          states of wealth but rather in changes of wealth. Two major events govern the way people may ascribe psychological value to a choice: potential losses and gains.
        </p>
    </div>
    <label for="dollarAmount">Dollar Amount</label>
    <input type="range" min="-200" max="200" value="0" class="slider" id="dollarAmount"><br>
    <div class="psychological-value">
      <h3>Psychological Value</h3>
      <h4>Loss</h4>
    </div>
    <label for="perceivedValue">Perceived Value</label>
    <input type="range" min="1" max="100" value="50" class="slider" id="perceivedValue"><br>

    <!-- Predict future with linear regression AND PCA -->
    <!-- <label for="marginalCost">Marginal Cost</label>
    <input type="range" min="1" max="100" value="50" class="slider" id="marginalCost"> -->

    <!---->
    <!-- <form action="post">
        <input id="search-input" name="search-input" type="text" placeholder="Mary Traded Clouds | Clouds Traded Mary."></input><br><br>
        <button type="submit" id="form__submit">Evaluate</button>
    </form> -->

    <div class="view-wrapper"></div>
    <div class="subheader">
        <div class="container flex">
            <div class="subheadings">
                <h3 id="viewing"></h3>
            </div>
            <div id="results-list"></div>
        </div>
    </div>
    <script>
        // JSONCreativeAPI
        // Author: sylvain tran for cart 351
        // This API can be used to rapidly fetch data from JSON and inject a response data into
        // a provided component.

        // Private namespace in global
        var queryJsonTest = queryJsonTest = queryJsonTest || {};

        queryJsonTest.queryJson = function (validateMethodInjection, fetchMethodInjection) {
            // Check args
            if (typeof validateMethodInjection !== 'function' || typeof fetchMethodInjection !== 'function') {
                console.error("queryJson needs functions to work.");
                return;
            }

            // Private
            // Dependency inversion
            const queryJsonValidate = validateMethodInjection;
            const queryJsonFetch = fetchMethodInjection;

            // Public
            return {
                execute: function () {
                    const queryFromUser = document.getElementById("search-input").value;
                    queryJsonFetch(queryFromUser, queryJsonValidate).getJson();
                    return false;
                },
                validate: queryJsonValidate,
                fetch: queryJsonFetch
            }
        }

        // Model layer
        // Injectable validate method
        queryJsonTest.validate = function (query, data) {
            let valid = false;
            let template = Object.keys(data[0]); // Gets the keys that we can enter from our JSON file

            // Bogus TODO change
            if (typeof query !== "string") {
                console.error("Please enter a valid text input.");
                return;
            }

            return {
                validate: function () {
                    const queryNormalized = query.toLowerCase().trim();
                    // If index is > -1 then query was found in the array of keys
                    template.indexOf(queryNormalized) > -1 ? valid = true : valid = false;
                    return valid;
                }
            }
        }

        // Injectable filter method
        // TODO make the fields by args
        queryJsonTest.filter = function (query, data) {
            // Format
            /**
                "day": "10-10-2020",
                "walk": "yes",
                "productive": "yes",
                "feelings": ["happy", "lonely", "calm"],
                "number of meals": 3,
                "meals": ["rice", "banana", "curry", "chicken legs"],
                "prayers": ["contentedness", "gratefulness", "peace", "self-control"]
            **/
            // Private
            let day = [];
            let walk = [];
            let productive = [];
            let feelings = [];
            let nbMeals = [];
            let meals = [];
            let prayers = [];
            let allData = data;

            // Immediately invoke this to fill data
            let fillData = (function () {
                for (let i = 0; i < data.length; i++) {
                    day.push(data[i]["day"]);
                    walk.push(data[i]["walk"]);
                    productive.push(data[i]["productive"]);
                    feelings.push(data[i]["feelings"]);
                    nbMeals.push(data[i]["number of meals"]);
                    meals.push(data[i]["meals"]);
                    prayers.push(data[i]["prayers"]);
                }
            })();

            // Public
            return {
                getQuery: function (index) {
                    switch (query) {
                        // Single primitives
                        case "day":
                            console.log("TEST DAY: ");
                            console.log(this.getDay(index));
                            return this.getDay(index);
                            break;
                        case "walk":
                            return this.getWalk(index);
                            break;
                        case "productive":
                            return this.getProductive(index);
                            break;
                        case "number of meals":
                            return this.getNbMeals(index);
                            break;
                            // Arrays:
                        case "feelings":
                            return this.getFeelings(index);
                            break;
                        case "meals":
                            return this.getMeals(index);
                            break;
                        case "prayers":
                            return this.getPrayers(index);
                            break;
                        default:
                            break;
                    }
                },
                getDay: function (index) {
                    if (index >= 0 && index < day.length)
                        return day[index];
                },
                getWalk: function (index) {
                    if (index >= 0 && index < walk.length)
                        return walk[index];
                },
                getProductive: function (index) {
                    if (index >= 0 && index < productive.length)
                        return productive[index];
                },
                getFeelings: function (index) {
                    if (index >= 0 && index < feelings.length)
                        return feelings[index];
                },
                getNbMeals: function (index) {
                    if (index >= 0 && index < nbMeals.length)
                        return nbMeals[index];
                },
                getMeals: function (index) {
                    if (index >= 0 && index < meals.length)
                        return meals[index];
                },
                getPrayers: function (index) {
                    if (index >= 0 && index < prayers.length)
                        return prayers[index];
                },
                getAll: function () {
                    return allData;
                }
            }
        }

        // Injectable fetch method using $.getJSON
        queryJsonTest.fetch = function (query, injectedValidator) {
            // Private
            let queryFromUser = query;
            let validator = injectedValidator;
            let dataFromJSON = null;
            let errorMsg = null;

            // Public
            return {
                getJson: function () {
                    $.getJSON('/dat/routine.json',
                        function (data) {
                            dataFromJSON = data;
                            console.log(dataFromJSON);
                            const valid = validator(queryFromUser, dataFromJSON).validate();
                            console.log(valid);
                            if (valid) {
                                // Then render the views
                                // TODO Make these UI elements--interactible
                                // Test for now: index at 0 -- will be passed in as arg later
                                view(queryJsonTest.filter(queryFromUser, dataFromJSON).getQuery(0));
                                // Pass dataFromJSON to the Bible search API
                                search(dataFromJSON);
                            }
                        }).fail(function () {
                        errorMsg = "json load error -- check path";
                        console.error(errorMsg);
                    });
                }
            }
        }

        // Controller layer
        // Event handling
        $(document).ready(function () {
            const JSONCreativeAPI = queryJsonTest.queryJson(queryJsonTest.validate, queryJsonTest.fetch);
            $("#form__submit").click(JSONCreativeAPI.execute);
        });

        // View layer
        const view = function (data) {
            // TODO make the component type a UI element--interactible
            factory.componentRender("h1", ".view-wrapper").render(data);
            // Arrays:
            // factory.componentRender("h4", ".view-wrapper").renders(data); break;
        }

        // Factory namespace for our components
        var factory = factory = factory || {};

        // Custom components for the view
        factory.component = function (css) {

        }

        // Renderer
        factory.componentRender = function (component, viewWrapperTarget) {
            return {
                // For single primitives
                render: function (data) {
                    const el = document.createElement(component);
                    const viewWrapper = document.querySelector(viewWrapperTarget);
                    // Append data to a text node
                    const txt = document.createTextNode(data);
                    el.appendChild(txt);
                    viewWrapper.append(el);
                },
                // For array types
                renders: function (data) {
                    for (let i = 0; i < data.length; i++) {
                        const el = document.createElement(component);
                        const viewWrapper = document.querySelector(viewWrapperTarget);
                        // Append data to a text node
                        const txt = document.createTextNode(data[i]);
                        el.appendChild(txt);
                        viewWrapper.append(el);
                    }
                }
            }
        }
    </script>
</body>

</html>
